#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Checking low-code compliance..."

# Emergency bypass for hotfixes
if [ -n "$EMERGENCY_BYPASS" ]; then
    echo "üö® EMERGENCY BYPASS: $EMERGENCY_BYPASS" | tee -a .emergency-bypasses.log
    exit 0
fi

# Run forbidden pattern detection
node ./tools/enforcement/scripts/detect-forbidden-patterns.cjs
if [ $? -ne 0 ]; then
    echo "‚ùå Forbidden patterns detected. Commit blocked."
    exit 1
fi

# Run tool usage verification if it exists
if [ -f "./tools/enforcement/scripts/verify-tool-usage.cjs" ]; then
    node ./tools/enforcement/scripts/verify-tool-usage.cjs
    if [ $? -ne 0 ]; then
        echo "‚ùå Tool usage verification failed. Commit blocked."
        exit 1
    fi
fi

# Run v0 compliance check if it exists
if [ -f "./tools/enforcement/scripts/check-v0-compliance.cjs" ]; then
    node ./tools/enforcement/scripts/check-v0-compliance.cjs
    if [ $? -ne 0 ]; then
        echo "‚ùå v0.dev compliance check failed. Commit blocked."
        exit 1
    fi
fi

echo "‚úÖ Low-code compliance check passed!"
